<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sony Bravia Remote Control</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="toast" class="toast">Settings saved successfully!</div>

    <div class="container">
        <!-- Input container for device discovery and controls -->
        <div class="input-container">
            <h1>Sony Bravia Remote Control</h1>

            <h2>Device Discovery</h2>
            <button id="discoverBtn">Discover Devices</button>
            <br />
            <label for="deviceSelect">Select a device:</label>
            <select id="deviceSelect"></select>

            <h2>TV Controls (PSK)</h2>
            TV IP: <input type="text" id="tvIp" value="192.168.68.68"><br>
            PSK: <input type="text" id="psk" value="1123"><br><br>
            <button id="saveSettingsBtn">Save Settings</button><br><br>
        </div>

        <!-- Remote buttons with blank slots 3x1 Row Layout -->
        <div class="remote-container">
            <button class="remote-button" id="Tv">TV</button>
            <div class="remote-button blank-slot"></div>
            <button class="remote-button" id="TvPower">Power</button>

            <button class="remote-button" id="TvInput">Input</button>
            <div class="remote-button blank-slot"></div>
            <button class="remote-button" id="TopMenu">Menu</button>

            <div class="remote-button blank-slot"></div>
            <div class="remote-button blank-slot"></div>
            <div class="remote-button blank-slot"></div>

            <div class="remote-button blank-slot"></div>
            <button class="remote-button" id="Up">Up</button>
            <div class="remote-button blank-slot"></div>

            <button class="remote-button" id="Left">Left</button>
            <button class="remote-button" id="Confirm">OK</button>
            <button class="remote-button" id="Right">Right</button>

            <div class="remote-button blank-slot"></div>
            <button class="remote-button" id="Down">Down</button>
            <div class="remote-button blank-slot"></div>

            <div class="remote-button blank-slot"></div>
            <div class="remote-button blank-slot"></div>
            <div class="remote-button blank-slot"></div>

            <button class="remote-button" id="Return">Back</button>
            <div class="remote-button blank-slot"></div>
            <button class="remote-button" id="Home">Home</button>

            <div class="remote-button blank-slot"></div>
            <div class="remote-button blank-slot"></div>
            <div class="remote-button blank-slot"></div>

            <button class="remote-button" id="VolumeUp">Volume Up</button>
            <div class="remote-button blank-slot"></div>
            <button class="remote-button" id="ChannelUp">Channel Up</button>

            <button class="remote-button" id="VolumeDown">Volume Down</button>
            <button class="remote-button" id="Mute">Mute</button>
            <button class="remote-button" id="ChannelDown">Channel Down</button>

            <button class="remote-button" id="PlayPause">Play/Pause</button>
            <div class="remote-button blank-slot"></div>
            <div class="remote-button blank-slot"></div>

            <button class="remote-button wide" id="Netflix">Netflix</button>
            <button class="remote-button wide" id="YouTube">YouTube</button>
        </div>
    </div>

    <script>
        // Load settings when the app loads
        window.settingsAPI.onLoadSettings((settings) => {
            if (settings.tvIp) {
                document.getElementById('tvIp').value = settings.tvIp;
            }
            if (settings.psk) {
                document.getElementById('psk').value = settings.psk;
            }
        });

        // Function to show toast notification
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Save settings when the "Save Settings" button is clicked
        document.getElementById('saveSettingsBtn').addEventListener('click', () => {
            const tvIp = document.getElementById('tvIp').value;
            const psk = document.getElementById('psk').value;

            window.settingsAPI.saveSettings({ tvIp, psk });

            console.log('Settings saved:', { tvIp, psk });

            showToast('Settings saved successfully!');
        });


        // Helper function to send IRCC commands
        function sendIRCCHelper(irccCode) {
            const tvIp = document.getElementById('tvIp').value;
            const psk = document.getElementById('psk').value;

            window.api.sendIRCCCommand(tvIp, irccCode, psk).then(response => {
                console.log('IRCC Command Response:', response);
            }).catch(error => {
                console.error('Error sending IRCC command:', error);
            });
        }

        // Load controller info and bind click events to buttons
        document.addEventListener('DOMContentLoaded', () => {
            const controllerInfo = window.api.controllerInfo;

            controllerInfo.forEach(item => {
                const button = document.getElementById(item.name);
                if (button) {
                    button.addEventListener('click', () => {
                        sendIRCCHelper(item.value);
                    });
                }
            });
        });

        // Device discovery button event
        document.getElementById('discoverBtn').addEventListener('click', () => {
            window.api.discoverDevices().then(devices => {
                const deviceSelect = document.getElementById('deviceSelect');
                deviceSelect.innerHTML = '';  // Clear the dropdown before adding new options

                devices.forEach(device => {
                    const option = document.createElement('option');
                    option.value = device.ip;
                    option.textContent = `${device.name} (${device.ip})`;
                    deviceSelect.appendChild(option);
                });

                if (devices.length > 0) {
                    document.getElementById('tvIp').value = devices[0].ip;
                }
            }).catch(error => {
                console.error('Error discovering devices:', error);
            });
        });

        document.getElementById('deviceSelect').addEventListener('change', (event) => {
            document.getElementById('tvIp').value = event.target.value;
        });
    </script>
</body>

</html>